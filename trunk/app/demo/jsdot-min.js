var jsonParse=(function(){var e="(?:-?\\b(?:0|[1-9][0-9]*)(?:\\.[0-9]+)?(?:[eE][+-]?[0-9]+)?\\b)";var k='(?:[^\\0-\\x08\\x0a-\\x1f"\\\\]|\\\\(?:["/\\\\bfnrt]|u[0-9A-Fa-f]{4}))';var j='(?:"'+k+'*")';var d=new RegExp("(?:false|true|null|[\\{\\}\\[\\]]|"+e+"|"+j+")","g");var l=new RegExp("\\\\(?:([^u])|u(.{4}))","g");var g={'"':'"',"/":"/","\\":"\\",b:"\b",f:"\f",n:"\n",r:"\r",t:"\t"};function h(m,n,o){return n?g[n]:String.fromCharCode(parseInt(o,16))}var c=new String("");var a="\\";var f={"{":Object,"[":Array};var b=Object.hasOwnProperty;return function(v,r){var q=v.match(d);var y;var w=q[0];var m=false;if("{"===w){y={}}else{if("["===w){y=[]}else{y=[];m=true}}var u;var s=[y];for(var p=1-m,o=q.length;p<o;++p){w=q[p];var x;switch(w.charCodeAt(0)){default:x=s[0];x[u||x.length]=+(w);u=void 0;break;case 34:w=w.substring(1,w.length-1);if(w.indexOf(a)!==-1){w=w.replace(l,h)}x=s[0];if(!u){if(x instanceof Array){u=x.length}else{u=w||c;break}}x[u]=w;u=void 0;break;case 91:x=s[0];s.unshift(x[u||x.length]=[]);u=void 0;break;case 93:s.shift();break;case 102:x=s[0];x[u||x.length]=false;u=void 0;break;case 110:x=s[0];x[u||x.length]=null;u=void 0;break;case 116:x=s[0];x[u||x.length]=true;u=void 0;break;case 123:x=s[0];s.unshift(x[u||x.length]={});u=void 0;break;case 125:s.shift();break}}if(m){if(s.length!==1){throw new Error()}y=y[0]}else{if(s.length){throw new Error()}}if(r){var t=function(D,C){var E=D[C];if(E&&typeof E==="object"){var n=null;for(var A in E){if(b.call(E,A)&&E!==D){var z=t(E,A);if(z!==void 0){E[A]=z}else{if(!n){n=[]}n.push(A)}}}if(n){for(var B=n.length;--B>=0;){delete E[n[B]]}}}return r.call(D,C,E)};y=t({"":y},"")}return y}})();var svgns="http://www.w3.org/2000/svg";var xlinkns="http://www.w3.org/1999/xlink";var xmlns="http://www.w3.org/2000/svg";var xlink="http://www.w3.org/1999/xlink";Number.prototype.NaN0=function(){return isNaN(this)?0:this};Element.prototype.appends=function(a){for(i in a){this.appendChild(a[i])}};Element.prototype.setAttrs=function(a){for(i in a){this.setAttribute(i,a[i])}};Element.prototype.size=function(){var a=this.style;return{width:parseInt(a.borderLeftWidth||0)+parseInt(a.borderRightWidth||0)+this.offsetWidth,height:parseInt(a.borderTopWidth||0)+parseInt(a.borderBottomWidth||0)+this.offsetHeight}};Element.prototype.getPos=function(){var c=0,b=0,a=this.offsetParent;while(a.offsetParent){c+=this.offsetLeft+(this.currentStyle?(parseInt(this.currentStyle.borderLeftWidth)).NaN0():0);b+=this.offsetTop+(this.currentStyle?(parseInt(this.currentStyle.borderTopWidth)).NaN0():0);a=this.offsetParent}c+=this.offsetLeft+(this.currentStyle?(parseInt(this.currentStyle.borderLeftWidth)).NaN0():0);b+=this.offsetTop+(this.currentStyle?(parseInt(this.currentStyle.borderTopWidth)).NaN0():0);return{x:c,y:b}};function $e(a){if(arguments[1]){return document.createElement(a)}return document.createElementNS(svgns,a)}function $(a){return document.getElementById(a)}function Class(){return function(a){this.init(a)}}function randColor(){return"rgb("+parseInt(Math.random()*255)+","+parseInt(Math.random()*255)+","+parseInt(Math.random()*255)+")"}function counter(a){var c=0;var b;for(b in a){c++}return c}function Class(){return function(){this.init.apply(this,arguments)}}var JSDot=new Class();JSDot.prototype={mainWin:null,selected_form:null,svg:null,graph:null,error:null,init:function(a){this.emptyGraph();if(typeof a=="string"){a={targetId:a}}if(a&&typeof a.targetId=="string"){this.svg=new JSVG({jsdot:this,targetId:a.targetId,leftMenu:a.leftMenu})}},add_figure:function(a){selected_form=a}};JSDot.prototype.Node=function(b,a){this._graph=b;this.name=a;this.attributes={};return this};JSDot.prototype.Node.prototype._setAttribute=function(a,b){this.attributes[a]=b};JSDot.prototype.Node.prototype._getAttribute=function(a){return this.attributes[a]};JSDot.prototype.Node.prototype.getEdgesIn=function(){var a=[];for(i in this._graph.edges){if(this._graph.edges[i].dst==this){a.push(this._graph.edges[i])}}return a};JSDot.prototype.Node.prototype.getEdgesOut=function(){var a=[];for(i in this._graph.edges){if(this._graph.edges[i].src==this){a.push(this._graph.edges[i])}}return a};JSDot.prototype.Node.prototype.getName=function(){return this.name};JSDot.prototype.Node.prototype.getLabel=function(){var a=this._getAttribute("label");return a?a:this.name};JSDot.prototype.Node.prototype.setLabel=function(a){this._setAttribute("label",a)};JSDot.prototype.Node.prototype.getPos=function(){var a=this._getAttribute("pos");if(typeof a!="string"){return[10,10]}a=a.split(",");if(a.length!=2){return[10,10]}return[parseFloat(a[0]),parseFloat(a[1])]};JSDot.prototype.Node.prototype.setPos=function(a,b){this._setAttribute("pos",""+a+","+b)};JSDot.prototype.Node.prototype.getColor=function(){return this._getAttribute("color")||"black"};JSDot.prototype.Node.prototype.setColor=function(a){this._setAttribute("color",a)};JSDot.prototype.Node.prototype.getFillColor=function(){return this._getAttribute("fillcolor")||"lightgrey"};JSDot.prototype.Node.prototype.setFillColor=function(a){this._setAttribute("fillcolor",a)};JSDot.prototype.Node.prototype.getFontColor=function(){return this._getAttribute("fontcolor")||"black"};JSDot.prototype.Node.prototype.setFontColor=function(a){this._setAttribute("fontcolor",a)};JSDot.prototype.Node.prototype.getShape=function(){return this._getAttribute("shape")||"circle"};JSDot.prototype.Node.prototype.setShape=function(a){this._setAttribute("shape",a)};JSDot.prototype.Edge=function(a,b){this.src=a;this.dst=b;this.attributes={};return this};JSDot.prototype.Edge.prototype._getAttribute=function(a){return this.attributes[a]};JSDot.prototype.Edge.prototype._setAttribute=function(a,b){this.attributes[a]=b};JSDot.prototype.Edge.prototype.getName=function(){var b=this.src.getName();var a=this.dst.getName();return b.length+":"+a.length+"-"+b+"-"+a};JSDot.prototype.Edge.prototype.getSrc=function(){return this.src};JSDot.prototype.Edge.prototype.setSrc=function(a){this.src=a};JSDot.prototype.Edge.prototype.getDst=function(){return this.dst};JSDot.prototype.Edge.prototype.setDst=function(a){this.dst=a};JSDot.prototype.Edge.prototype.getLabel=function(){var a=this._getAttribute("label");return a?a:""};JSDot.prototype.Edge.prototype.setLabel=function(a){this._setAttribute("label",a)};JSDot.prototype.Edge.prototype.getColor=function(){return this._getAttribute("color")||"black"};JSDot.prototype.Edge.prototype.setColor=function(a){this._setAttribute("color",a)};JSDot.prototype.Edge.prototype.getFontColor=function(){return this._getAttribute("fontcolor")||"black"};JSDot.prototype.Edge.prototype.setFontColor=function(a){this._setAttribute("fontcolor",a)};JSDot.prototype.isDirected=function(){return this.graph.directed};JSDot.prototype.setDirected=function(a){this.graph.directed=a};JSDot.prototype.newNode=function(a){if(!a){while(this.getNodeByName(a=this._getNextGenName())){}}else{if(this.getNodeByName(a)){return null}}var b=new this.Node(this.graph,a);this.graph.nodes[a]=b;return b};JSDot.prototype.getNodeByName=function(a){return this.graph.nodes[a]};JSDot.prototype.getNodesCount=function(){return this.getNodesArray().length};JSDot.prototype.getNodesArray=function(){var b=[];for(var a in this.graph.nodes){b.push(this.graph.nodes[a])}return b};JSDot.prototype.removeNode=function(a){if(a instanceof this.Node){a=a.name}delete (this.graph.nodes[a]);for(edge in this.graph.edges){if(this.graph.edges[edge].getSrc().name==a){delete (this.graph.edges[edge])}if(this.graph.edges[edge]){if(this.graph.edges[edge].getDst().name==a){delete (this.graph.edges[edge])}}}};JSDot.prototype.newEdge=function(b,c){if(typeof b=="string"){b=this.getNodeByName(b)}if(typeof c=="string"){c=this.getNodeByName(c)}var a=new this.Edge(b,c);this.graph.edges[a.getName()]=a;return a};JSDot.prototype.getEdgeByName=function(a){return this.graph.edges[a]};JSDot.prototype.removeEdge=function(a){if(a instanceof this.Edge){a=a.getName()}delete (this.graph.edges[a])};JSDot.prototype.getEmptyGraph=function(){return{name:"",directed:false,nodes:{},edges:{},attributes:{}}};JSDot.prototype.emptyGraph=function(){this.graph=this.getEmptyGraph()};JSDot.prototype._getNextGenName=function(){var a=[-1];return function(){var c="abcdefghijklmnopqrstuvwxyz";var b=c.length;a[0]++;var e=0;while(a[e]>=b){a[e]=0;a[e+1]=(a[e+1]!=undefined?a[e+1]+1:0);e++}var d="";for(var e=a.length-1;e>=0;e--){d+=c[a[e]]}return d}}();JSDot.template=[["Tree",'{							"name": "tree",							"directed": false,							"nodes": [				  						{"name": "node1", "attributes": {"label": "a", "color": "blue", "pos": "200,100"}},		          						{"name": "node2", "attributes": {"label": "b", "color": "red", "pos": "500,100"}},				 						{"name": "node3", "attributes": {"label": "c", "color": "yellow", "pos": "200,500"}},				  						{"name": "node4", "attributes": {"label": "d", "color": "green","pos": "500,500"}}				  					  ],							"edges": [				  						{"src": "node1", "dst": "node2", "attributes": {"label": "edge1", "style": "solid"}},				  						{"src": "node2", "dst": "node3", "attributes": {"label": "edge2", "style": "solid"}},				  						{"src": "node3", "dst": "node4", "attributes": {"label": "edge3", "style": "solid"}}				 					 ],							"attributes": {										"label": "unddirected graph with four nodes and three edges (connected)"							}							}'],["Single Node",'{									"name": "single node",									"directed": false,									 "nodes": [									 			{"name": "node1", "attributes": {"label": "a", "color": "blue", "pos": "200,100"}},											   ],									"edges": [],									"attributes": {										"label": "graph with a single node"									}								}'],["Binary Tree",'{									"name":"binary tree",									"directed":false,									"nodes":[											{"name":"node1","attributes":{"label":"17","color":"blue","pos":"489,58"}},											{"name":"node2","attributes":{"label":"19","color":"red","pos":"741,267"}},											{"name":"node3","attributes":{"label":"18","color":"green","pos":"642,362"}},											{"name":"node4","attributes":{"label":"20","color":"green","pos":"856,362"}},											{"name":"node5","attributes":{"label":"15","color":"red","pos":"293,265"}},											{"name":"node6","attributes":{"label":"16","color":"green","pos":"409,367"}},											{"name":"node7","attributes":{"label":"14","color":"green","pos":"186,366"}}											],									"edges":[											{"src":"node1","dst":"node2","attributes":{"label":"","style":"solid"}},											{"src":"node2","dst":"node3","attributes":{"label":"","style":"solid"}},											{"src":"node2","dst":"node4","attributes":{"label":"","style":"solid"}},											{"src":"node1","dst":"node5","attributes":{"label":"","style":"solid"}},											{"src":"node5","dst":"node6","attributes":{"label":"","style":"solid"}},											{"src":"node5","dst":"node7","attributes":{"label":"","style":"solid"}}											],									"attributes":{											"label":"binary tree example"											}								}'],["Generic Graph",'{									"name": "generic graph",									"directed": false,									"nodes":[											{"name":"node1","attributes":{"label":"A","color":"blue","pos":"489,58"}},											{"name":"node2","attributes":{"label":"B","color":"red","pos":"741,267"}},											{"name":"node3","attributes":{"label":"C","color":"green","pos":"642,362"}},											{"name":"node4","attributes":{"label":"D","color":"yellow","pos":"856,362"}},									],									"edges":[											{"src":"node1","dst":"node2","attributes":{"label":"edge1","style":"solid"}},											{"src":"node2","dst":"node3","attributes":{"label":"edge2","style":"solid"}},											{"src":"node3","dst":"node1","attributes":{"label":"edge3","style":"solid"}},									],									"attributes":{											"label":"generic graph"											}									}'],["Directed Graph",'{									"name": "directed graph",									"directed": true,									"nodes":[											{"name":"node1","attributes":{"label":"A","color":"blue","pos":"489,58"}},											{"name":"node2","attributes":{"label":"B","color":"red","pos":"741,267"}},											{"name":"node3","attributes":{"label":"C","color":"green","pos":"642,362"}},											{"name":"node4","attributes":{"label":"D","color":"yellow","pos":"856,362"}},									],									"edges":[											{"src":"node1","dst":"node2","attributes":{"label":"edge1","style":"solid"}},											{"src":"node2","dst":"node3","attributes":{"label":"edge2","style":"solid"}},											{"src":"node3","dst":"node1","attributes":{"label":"edge3","style":"solid"}},									],									"attributes":{											"label":"directed graph"											}									}'],["Star graph",'{								"name":"Star graph",								"directed":false,								"nodes":[									{"name":"node1","attributes":{"pos":"580,100","label":"A1","color":"black","fontcolor":"black","fillcolor":"yellow"}},									{"name":"node2", "attributes":{"pos":"780, 250","label":"A2","color":"black","fontcolor":"black","fillcolor":"yellow"}},									{"name":"node3", "attributes":{"pos":"380, 250","label":"A3","color":"black","fontcolor":"black","fillcolor":"yellow"}},									{"name":"node4", "attributes":{"pos":"680, 450","label":"A4","color":"black","fontcolor":"black","fillcolor":"yellow"}},									{"name":"node5", "attributes":{"pos":"480, 450","label":"A5","color":"black","fontcolor":"black","fillcolor":"yellow"}},									],								"edges":[									{"src":"node3","dst":"node2","attributes":{"fillcolor":"yellow","label":"","color":"yellow","fontcolor":"black"}},									{"src":"node4","dst":"node1","attributes":{"fillcolor":"yellow","label":"","color":"yellow","fontcolor":"black"}},									{"src":"node1","dst":"node5","attributes":{"fillcolor":"yellow","label":"","color":"yellow","fontcolor":"black"}},									{"src":"node3","dst":"node4","attributes":{"fillcolor":"yellow","label":"","color":"yellow","fontcolor":"black"}},									{"src":"node5","dst":"node2","attributes":{"fillcolor":"yellow","label":"","color":"yellow","fontcolor":"black"}},								],								"attributes":{}}']];var JSVG=new Class();JSVG.prototype={designArea:null,coords:null,selected:null,popup:null,edge:null,current:null,leftMenuSize:220,init:function(b){this.jsdot=b.jsdot;this.container=$(b.targetId);this.svgdoc=this.container.ownerDocument;this.svgroot=$e("svg");JSVG.svgroot=this.svgroot;this.container.appendChild(this.svgroot);this.container.style.position="relative";this.popup=new Popup(this,this.container,"popup");if(b.leftMenu){this.buildMenu()}else{this.leftMenuSize=0}this.svgroot.setAttrs({width:window.innerWidth-this.leftMenuSize,id:"svgroot",xmlns:svgns,"xmlns:xlink":xlinkns});this.coords=this.svgroot.createSVGPoint();this.grabPoint=this.svgroot.createSVGPoint();var a=this;this.svgroot.addEventListener("mousemove",function(c){if(a.selected=="edge"&&a.edge!=null){a.edge.setAttrs({x2:c.clientX-a.leftMenuSize-2,y2:c.clientY-2})}else{a.drag(c)}},false);this.svgroot.addEventListener("mouseup",function(c){a.drop(c)},false);this.svgroot.addEventListener("click",function(c){a.dispatchEvent(c)},false);this.svgroot.addEventListener("mousedown",function(c){if(c.which==2||c.which==3){a.showRightMenu(c)}},false);window.addEventListener("keypress",function(c){switch(c.keyCode){case 27:a.popup.hide();a.selected=null;a.pointOne=false;if(a.edge){a.edge.parentNode.removeChild(a.edge);a.edge=null}break}},false);window.addEventListener("resize",function(c){a.svgroot.setAttribute("width",window.innerWidth-a.leftMenuSize)},false);document.oncontextmenu=new Function("return false")},showRightMenu:function(a){if(!this.rightMenuCnt){this.rightMenuCnt=$e("div",true);this.rightMenuCnt.setAttrs({style:"top:"+a.clientY+"px;left:"+a.clientX+"px;border:2px solid #999;-moz-border-radius: 5px; -webkit-border-radius: 5px;","class":"rightMenu"});var b=this,c;var d={"delete":function(){b.deleteElement(b.node_name.slice(2),b.node_name[0])},"show attributes":function(){b.popup.show_attributes(b.node_name.slice(2),b.node_name[0])}};for(label in d){c=$e("a",true);c.addEventListener("click",d[label],false);c.innerHTML=label;this.rightMenuCnt.appendChild(c)}this.container.appendChild(this.rightMenuCnt)}else{this.rightMenuCnt.style.display="block";this.rightMenuCnt.style.top=a.clientY+"px";this.rightMenuCnt.style.left=a.clientX+"px"}this.node_name=a.target.parentNode.id;var e;if((this.node_name[0]=="n"||this.node_name[0]=="e")&&this.node_name[1]=="_"){this.rightMenuCnt.addEventListener("mouseout",function(f){var g=this;e=setTimeout(function(){g.style.display="none"},500)},false);this.rightMenuCnt.addEventListener("mouseover",function(f){clearTimeout(e)},false)}else{this.rightMenuCnt.style.display="none"}},deleteElement:function(a,b){if(b=="e"){this.jsdot.removeEdge(a)}else{this.jsdot.removeNode(a)}this.jsdot.draw()},dispatchEvent:function(a){var b=this,c;if(this.selected!=null){if(b.selected!="edge"){if(this.selected=="circle"){var d=this.jsdot.newNode();d.setPos(a.clientX-this.leftMenuSize,a.clientY);this.drawNode(d)}else{throw ({name:"RangeError",message:"unexpected selection"})}}}},getCoords:function(a){var b=this.svgroot.currentScale,c=this.svgroot.currentTranslate;this.coords.x=(a.clientX-c.x)/b;this.coords.y=(a.clientY-c.y)/b},grab:function(b){var e=b.currentTarget;if(this.designArea!=e){this.selected=e;var d=e.getCTM();this.getCoords(b);this.grabPoint.x=this.coords.x-Number(d.e)+this.leftMenuSize;this.grabPoint.y=this.coords.y-Number(d.f);this.dragElement=e;this.dragElement.setAttributeNS(null,"pointer-events","none");if(e.id.slice(0,2)=="n_"){this.dragEdges=[];var c=e.id.slice(2);var a,h,g;this.dragEdges[0]=this.jsdot.getNodeByName(c).getEdgesIn();for(var f in this.dragEdges[0]){a=$("e_"+this.dragEdges[0][f].getName()+"+text");if(a){a.style.display="none"}a=$("e_"+this.dragEdges[0][f].getName()+"+line");h=this.dragEdges[0][f].getSrc().getPos();g=this.dragEdges[0][f].getDst().getPos();this.dragEdges[0][f]=[a,"M"+h+"L",g[0],g[1]]}this.dragEdges[1]=this.jsdot.getNodeByName(c).getEdgesOut();for(var f in this.dragEdges[1]){a=$("e_"+this.dragEdges[1][f].getName()+"+text");if(a){a.style.display="none"}a=$("e_"+this.dragEdges[1][f].getName()+"+line");h=this.dragEdges[1][f].getSrc().getPos();g=this.dragEdges[1][f].getDst().getPos();this.dragEdges[1][f]=[a,h[0],h[1],"L"+g]}}}},drag:function(a){if(this.dragElement){this.getCoords(a);var d=this.coords.x-this.grabPoint.x;var c=this.coords.y-this.grabPoint.y;this.dragElement.setAttributeNS(null,"transform","translate("+d+","+c+")");if(this.dragEdges[0]){for(var b in this.dragEdges[0]){this.dragEdges[0][b][0].setAttribute("d",this.dragEdges[0][b][1]+(this.dragEdges[0][b][2]+d)+","+(this.dragEdges[0][b][3]+c))}for(var b in this.dragEdges[1]){this.dragEdges[1][b][0].setAttribute("d","M"+(this.dragEdges[1][b][1]+d)+","+(this.dragEdges[1][b][2]+c)+this.dragEdges[1][b][3])}}}},drop:function(c){if(this.dragElement!=null){this.getCoords(c);var b=this.coords.x-this.grabPoint.x;var a=this.coords.y-this.grabPoint.y;var d=this.jsdot.getNodeByName(this.dragElement.id.slice(2));var e=d.getPos();d.setPos(e[0]+b,e[1]+a);this.dragElement.setAttributeNS(null,"pointer-events","all");this.dragElement=null;this.dragEdges=[];this.selected=null;this.jsdot.draw()}},selectObj:function(a){if(this.current!=null){this.current.setAttribute("class","btn")}this.current=a instanceof SVGCircleElement?a.parentNode:a;this.current.setAttribute("class","btn_sel")},buildMenu:function(){var r=this,j,m;this.toggle=false;this.cnt=$e("div",true);this.cnt.setAttrs({id:"leftMenu"});m=$e("div",true);m.setAttribute("class","title");h3=$e("h3",true);h3.innerHTML="Javascript Dot";j=$e("div",true);j.setAttrs({id:"toggle"});j.addEventListener("click",function(o){r.toggleMenu()},false);var l=$e("svg"),a=$e("circle");l.setAttribute("class","btn");a.addEventListener("click",function(o){r.selected="circle";r.selectObj(this)},false);a.setAttrs({r:"22",cx:"25",cy:"25",stroke:"#ffa500",fill:"#bfbfbf"});l.appendChild(a);var q=$e("svg"),s=$e("path");q.setAttribute("class","btn");s.setAttrs({d:"M 8.7185878,4.0337352 L -2.2072895,0.016013256 L 8.7185884,-4.0017078 C 6.9730900,-1.6296469 6.9831476,1.6157441 8.7185878,4.0337352 z",style:"font-size:12.0;fill-rule:evenodd;stroke-width:0.62500000;stroke-linejoin:round;fill:grey"});s.setAttribute("transform","translate(10, 10) scale(4) rotate(45)");q.addEventListener("click",function(o){r.selected="edge";r.selectObj(this)},false);q.setAttribute("class","btn");q.appendChild(s);var k=$e("div",true);k.setAttribute("class","btn");k.addEventListener("click",function(){r.popup.show_JSON();r.selectObj(null)},false);k.innerHTML="<span>JSON Code</span>";var g=$e("div",true);g.setAttribute("class","btn");g.addEventListener("click",function(){r.popup.show_SVG();r.selectObj(null)},false);g.innerHTML="<span>SVG Code</span>";var p=$e("div",true);p.setAttribute("class","btn");p.addEventListener("click",function(){if(r.jsdot.layout&&r.jsdot.layout.layout){r.jsdot.layout.layout();r.jsdot.draw()}r.selectObj(null)},false);p.innerHTML="<span>Auto Layout</span>";var d=$e("div",true);d.setAttribute("class","btn");d.addEventListener("click",function(){r.jsdot.setDirected(!r.jsdot.isDirected());r.jsdot.draw();r.selectObj(null)},false);d.innerHTML="<span>Dir / Undir</span>";var e=document.createElement("div");e.setAttribute("style","float-left:5px");var c=document.createElement("select");c.setAttribute("name","examples");c.setAttribute("id","examples");for(var h=0;h<JSDot.template.length;h++){var b=$e("option",true);b.setAttribute("value",JSDot.template[h][0]);b.appendChild(document.createTextNode(JSDot.template[h][0]));b.addEventListener("click",function(o){return function(){r.jsdot.loadJSON(JSDot.template[o][1]);r.jsdot.draw()}}(h),false);c.appendChild(b)}e.appendChild(c);var f=$e("div",true);f.setAttribute("class","btn");f.addEventListener("click",function(){r.popup.show_help();r.selectObj(null)},false);f.innerHTML="<span>Help</span>";var n=$e("div",true);n.setAttribute("id","footer");n.innerHTML='JSDot 2009 - USI Lugano<br /><a href="http://atelier.inf.usi.ch/~blondell/">Lucia Blondel</a> | <a href="http://atelier.inf.usi.ch/~giuliann/">Nicos Giuliani</a> | <a href="http://atelier.inf.usi.ch/~vaninic/">Carlo Vanini</a>';this.cnt.appends([m,h3,j,l,q,n,k,g,f,p,d,e]);this.container.appendChild(this.cnt)},toggleMenu:function(){var b=this,c,a;if(this.toogle){c=b.leftMenuSize,a=setInterval(function(){if(0==c){clearInterval(a)}b.svgroot.setAttrs({width:window.innerWidth-(b.leftMenuSize-c-3)});b.cnt.setAttrs({style:"margin-left:-"+((c-=5)-10)+"px"})},10);this.toogle=false;return}c=0,a=setInterval(function(){if(b.leftMenuSize==c){clearInterval(a)}b.svgroot.setAttrs({width:window.innerWidth-(b.leftMenuSize-c+3)});b.cnt.setAttrs({style:"margin-left:-"+((c+=5)-10)+"px"})},10);this.toogle=true},Element:function(c,a){var d=$e(c);var b=$e("g");b.setAttrs(a);delete a.id;d.setAttrs(a);b.appendChild(d);arguments[2]?arguments[2].appendChild(b):JSVG.svgroot.appendChild(b);return b},addEdge:function(a){if(a.currentTarget.id.slice(0,2)=="n_"){if(this.pointOne){var d=a.currentTarget.id.slice(2);var c=this.jsdot.newEdge(this.src,d);this.edge.parentNode.removeChild(this.edge);this.edge=null;this.pointOne=false;this.drawEdge(c)}else{var b=this.jsdot.getNodeByName(a.currentTarget.id.slice(2)).getPos();this.src=a.currentTarget.id.slice(2);this.edge=$e("line");this.edge.setAttrs({stroke:"black",x1:b[0],y1:b[1],x2:b[0],y2:b[1]});this.svgroot.insertBefore(this.edge,this.svgroot.firstChild);this.pointOne=true}}},getSVGContent:function(){return this.svgroot}};JSDot.prototype.draw=function(){var b=this.graph;this.svg.clear();for(var a in b.edges){this.svg.drawEdge(b.edges[a])}for(var a in b.nodes){this.svg.drawNode(b.nodes[a])}};JSVG.prototype.drawNode=function(f){var d=f.getPos();var c;if(f.getShape()=="box"){var a=f.getLabel().length;c=this.Element("rect",{id:"n_"+f.getName(),x:d[0]-(a/2*12)-15,y:d[1]-15,height:30,width:a*12+30,stroke:f.getColor(),fill:f.getFillColor()})}else{c=this.Element("circle",{id:"n_"+f.getName(),r:"2.5em",cx:d[0],cy:d[1],stroke:f.getColor(),fill:f.getFillColor()})}c.addEventListener("mousedown",function(e){return function(g){if(e.selected=="edge"){e.addEdge(g)}else{if(g.which!=2&&g.which!=3){e.grab(g)}}}}(this),false);var b=$e("text");b.setAttrs({x:d[0],y:d[1],stroke:"none",fill:f.getFontColor(),"text-anchor":"middle","dominant-baseline":"middle"});b.textContent=f.getLabel();c.appendChild(b)};JSVG.prototype.drawEdge=function(c){var n=c.src.getPos();var k=c.dst.getPos();var a="fill:none;stroke-width:1;";a+="stroke:"+c.getColor()+";";var m={d:"M"+n+"L"+k,style:a};if(this.jsdot.graph.directed){m["marker-end"]="url(#Arrow)"}var d=$e("path");d.setAttribute("id","e_"+c.getName()+"+line");d.setAttrs(m);var e=$e("path");if(k[0]<n[0]){m={d:"M"+k+"L"+n}}else{m={d:"M"+n+"L"+k}}m.style="fill:none;stroke:yellow;opacity:0;stroke-width:10;";m.id="e_"+c.getName()+"+handle";e.setAttrs(m);var f=$e("g");f.setAttribute("id","e_"+c.getName());f.appendChild(e);f.appendChild(d);var j=c.getLabel();if(j){var q=$e("tspan");q.setAttribute("dy","-5");q.textContent=j;var b=$e("textPath");b.setAttributeNS(xlinkns,"xlink:href","#e_"+c.getName()+"+handle");b.setAttrs({startOffset:"50%","text-anchor":"middle"});b.appendChild(q);var o=$e("text");o.setAttribute("fill",c.getFontColor());o.setAttribute("id","e_"+c.getName()+"+text");o.appendChild(b);f.appendChild(o)}this.svgroot.insertBefore(f,this.svgroot.firstChild)};JSVG.prototype.drawFragments=function(){var a=$e("defs");var b=$e("marker");b.setAttrs({id:"Arrow",orient:"auto",refX:"2.5em",refY:"0.0",style:"overflow:visible"});var c=$e("path");c.setAttrs({d:"M 8.7185878,4.0337352 L -2.2072895,0.016013256 L 8.7185884,-4.0017078 C 6.9730900,-1.6296469 6.9831476,1.6157441 8.7185878,4.0337352 z",style:"font-size:12.0;fill-rule:evenodd;stroke-width:0.62500000;stroke-linejoin:round"});c.setAttribute("transform","scale(1.1) rotate(180) translate(1,0)");b.appendChild(c);a.appendChild(b);this.svgroot.appendChild(a)};JSVG.prototype.clear=function(){while(this.svgroot.lastChild){this.svgroot.removeChild(this.svgroot.lastChild)}this.drawFragments()};JSDot.prototype.loadJSON=function(l){var c=0;try{if(l.constructor==String){if(JSON!=undefined){l=JSON.parse(l)}else{l=jsonParse(l)}}}catch(k){if(k instanceof SyntaxError){k.message="The input is not a valid JSON string";this.error=k;return 2}else{throw (k)}}function b(e){return(e!=undefined&&e.constructor==String)?e:""}function o(e){return(e!=undefined&&e.constructor==Object)?new Object(e):{}}this.emptyGraph();var j=this.graph;j.name=b(l.name);j.directed=l.directed?true:false;j.attributes=o(l.attributes);j.nodes={};j.edges={};if(l.nodes.constructor==Array){for(var h=0;h<l.nodes.length;h++){var f=l.nodes[h];var a=b(typeof f=="string"?f:f.name);var d=this.newNode(a);if(!d){this.error={name:"RangeError",message:'duplicate node name "'+a+'"'};c=1}else{d.attributes=o(f.attributes)}}}else{this.error={name:"TypeError",message:'"nodes" must be an array'};c=1}if(l.edges.constructor==Array){for(var h=0;h<l.edges.length;h++){var m=l.edges[h];var k=this.newEdge(m.src,m.dst);if(!k){this.error={name:"RangeError",message:"found edge with inexistent node"};c=1}else{k.attributes=o(m.attributes)}}}else{this.error={name:"TypeError",message:'"nodes" must be an array'};c=1}return c};JSDot.prototype.toJSON=function(){var f=this.graph;var b={};b.name=f.name;b.directed=f.directed;b.nodes=[];b.edges=[];for(var a in f.nodes){var d=f.nodes[a];var j={};j.name=d.name;j.attributes=d.attributes;b.nodes.push(j)}for(var a in f.edges){var c=f.edges[a];var h={};h.src=c.src.name;h.dst=c.dst.name;h.attributes=c.attributes;b.edges.push(h)}b.attributes=f.attributes;return JSON.stringify(b)};var Popup=new Class();Popup.prototype={doc:null,backDiv:null,newDiv:null,jsdot:null,init:function(b,d,c){var a=this;this.svg=b;this.jsdot=b.jsdot;this.doc=d.ownerDocument;this.backDiv=this.doc.createElement("div");this.backDiv.setAttribute("style","position:absolute; height:100%; width:100%; opacity: 0.9; background-color:#000; display:none; z-index:1000");this.newDiv=this.doc.createElement("div");this.newDiv.setAttribute("style","border:2px solid #666;overflow:hidden; -moz-border-radius: 5px; -webkit-border-radius: 5px;position:absolute; left:10%; top:10%; padding:8px; height:80%; width:80%; background:#ddd; padding:0.4em; display:none; z-index:1000");this.closeBtn=$e("div",true);this.closeBtn.className="closeBtn";this.closeBtn.addEventListener("click",function(e){a.hide(e)},false);this.newDiv.appendChild(this.closeBtn);window.addEventListener("keypress",function(e){switch(e.keyCode){case 13:if(a.newDiv.innerHTML!=""){$("save button").click()}break}},false);d.appends([this.backDiv,this.newDiv])},show_JSON:function(){var b=this;this.text_area=$e("textarea",true);var c=$e("input",true);var d=$e("p",true);var a=$e("input",true);this.text_area.setAttrs({id:"text",name:"text",style:"border:1px solid #666; -moz-border-radius: 5px; -webkit-border-radius: 5px;height:80%; width:97%;margin:20px auto 0 auto; border:1px solid #666;"});a.setAttrs({id:"save button",value:"load and save",type:"submit",});c.setAttrs({id:"exit button",value:"Exit",type:"submit"});c.addEventListener("click",function(e){b.hide(e)},false);a.addEventListener("click",function(e){b.load_string(e)},false);d.appends([a,c]);this.newDiv.appends([this.text_area,d]);this.text_area.innerHTML=this.jsdot.toJSON();this.show()},show_attributes:function(f,c){if(typeof f=="string"){if(c&&c=="e"){f=this.jsdot.getEdgeByName(f)}else{f=this.jsdot.getNodeByName(f)}}else{if(f instanceof this.jsdot.Edge){c="e"}else{c="n"}}var q=this;var a=$e("div",true);a.setAttribute("style","border:2px solid #666; -moz-border-radius: 5px; -webkit-border-radius: 5px;margin:2em;background:#eee;padding:1em;");var l=[];var n=$e("input",true);n.setAttrs({id:"label",name:"label",type:"text",value:f.getLabel(),});var g=$e("label",true);g.setAttribute("for","label");g.innerHTML="Label ";l.push(g);l.push(n);var e=this.colorPicker("line_color","Line Color",f.getColor());l.push(e);var o;if(c=="n"){o=this.colorPicker("fill_color","Fill Color",f.getFillColor());l.push(o)}var h;h=this.colorPicker("font_color","Font Color",f.getFontColor());l.push(h);var k;if(c=="n"){k=this.dropDown("shape","Shape",["circle","box"],f.getShape());l.push(k)}var b=$e("p",true);var m=document.createElement("input");var j={id:"save button",value:"change",type:"submit",};m.setAttrs(j);m.addEventListener("click",function(p){q.change_element(p,f,c)},false);var d=document.createElement("input");var r={id:"exit button",value:"Exit",type:"submit"};d.setAttrs(r);d.addEventListener("click",function(p){q.hide(p)},false);b.appends([m,d]);l.push(b);a.appends(l);this.newDiv.appendChild(a);this.show()},show_SVG:function(){var a=this;this.text_area=$e("textarea",true),svgImg=$e("div",true);this.text_area.setAttrs({id:"text",name:"text",style:"border:1px solid #666; -moz-border-radius: 5px;float:left;-webkit-border-radius: 5px;height:80%; width:97%;margin:20px auto 0 auto; border:1px solid #666;"});svgImg.appendChild(this.svg.getSVGContent());this.text_area.innerHTML=svgImg.innerHTML;this.svg.container.appendChild(this.svg.getSVGContent());this.newDiv.appends([this.text_area]);this.show()},show_help:function(){var c=$e("div",true);c.setAttribute("class","help");var b=$e("p",true);var a=this;str='<h2>JSDot quick guide:</h2>				<ul><li>Functionalities:</li>				<ul>  				<li><b>Arrow button</b>: Allows the drag and drop of elements in the design area.</li> 				<li><b>Node</b>: Allows to draw nodes.</li>				<li><b>Edge</b>: Allows to draw edges.</li>				<li><b>JSON code</b>: Shows your graph model and allows you to make changes on it.</li>				<li><b>SVG code</b>: Shows your graph model as a SVG representation.</li>				<li><b>Escape button</b>: Undo any actions.</li></ul></ul>				<br /><p>Enjoy JSDot! For more informations visit the <a href="http://code.google.com/p/jsdot/" target="_blank"> JSDot website</a>.</p>';c.innerHTML=str;c.appends([b]);this.newDiv.appendChild(c);this.show()},hide:function(a){(this.backDiv).style.display="none";(this.newDiv).style.display="none";var b=this.newDiv.childNodes;while(b.length>=1){this.newDiv.removeChild(this.newDiv.firstChild)}},show:function(a){this.backDiv.style.display="";this.newDiv.style.display="";this.newDiv.appendChild(this.closeBtn)},load_string:function(a){var b=$("text").value;if(b!=""){this.jsdot.loadJSON(b);this.jsdot.draw()}var c=$("exit button");c.click()},change_element:function(a,b,c){b.setLabel($("label").value);b.setColor($("line_color").value);b.setFontColor($("font_color").value);if(c=="n"){b.setFillColor($("fill_color").value);b.setShape($("shape").value)}this.jsdot.draw();var d=$("exit button");d.click()},colorPicker:function(e,b,d,c){var a=["black","blue","yellow","red","green","lightgrey","white"];return this.dropDown(e,b,a,d,c)},dropDown:function(b,h,k,d,j){var a=$e("div",true);if(h){var f=$e("label",true);f.innerHTML=h+" ";a.appendChild(f)}var c=$e("select",true);c.setAttribute("id",b);for(var e in k){var g=$e("option",true);g.setAttribute("value",k[e]);if(k[e]==d){g.setAttribute("selected","true")}g.appendChild(document.createTextNode(k[e]));c.appendChild(g)}a.appendChild(c);if(j){j.appendChild(a)}return a}};var Check=new Class();Check.prototype={graph:null,no_nodes:0,visited:new Array(),parent:new Array(),init:function(a){this.graph=a.graph;this.no_nodes=this.counter(this.graph.nodes);this.check_directed()},check_directed:function(){var a;for(a in this.graph.nodes){this.parent[a]=null}for(a in this.graph.nodes){if(!this.visited[a]){this.check_directed_modified(a)}}},check_directed_modified:function(a){this.visited[this.visited.length]=a;alert(this.visited);return},look_for_cycle:function(){},check_undirected:function(){},counter:function(a){var c=0;var b;for(b in a){c++}return c}};